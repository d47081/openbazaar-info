var Search={registry:{filterCountriesList:[],},loadSorts:function(d,a){var c=$("<div/>",{"class":"toolbar"});var b=$("<div/>",{"class":"dropdown-menu",});$(d).append(c.append(b));$.ajax({url:"api/search/sorts",type:"GET",data:{t:a,q:ModuleSearch.input.q.getValue(),s:ModuleSearch.input.s.getValue(),o:ModuleSearch.input.o.getValue(),},success:function(e){if(e.success){$(e.options).each(function(){b.append($("<small/>",{"class":"dropdown-item cursor-pointer",onclick:"ModuleSearch.submitSortOrder('"+this.s+"', '"+this.o+"');"}).append(this.name));if(this.divider){b.append($("<div/>",{"class":"dropdown-divider",}))}});c.prepend($("<div/>",{"class":"btn btn-sm dropdown-toggle mr-4 pl-0 pr-0","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false",}).append($("<span/>").text(e.title)))}},})},filterCountries:function(a){if(a!=""){$("#filterCountryNotFound").removeClass("d-none");$(".filter-passive-countries .filter-country").hide();$(Search.registry.filterCountriesList).each(function(){if(-1!==this.name.toLowerCase().indexOf(a)){$("#filterCountry-"+this.code).show();$("#filterCountryNotFound").addClass("d-none")}})}else{$(".filter-passive-countries .filter-country").show();$("#filterCountryNotFound").addClass("d-none")}},loadFilterCountries:function(f,i){var j=[];var g=$("<div/>",{"class":"toolbar"});var b=$("<div/>",{"class":"dropdown-menu pt-0",});var a=$("<div/>",{"class":"border-bottom pl-2 pr-2 pb-1 mb-2"}).append($("<i/>",{"class":"material-icons text-secondary pl-1"}).append("search")).append($("<input/>",{"class":"border-0 pl-2 pr-2 pt-2",name:"filterCountries",type:"text",placeholder:"Search",value:"",onkeyup:"Search.filterCountries($(this).val())"}));var d=$("<div/>",{"class":"dropdown-list",});var c=$("<div/>",{"class":"border-bottom mb-2 pb-2",});var h=$("<div/>",{"class":"filter-passive-countries",}).append($("<div/>",{id:"filterCountryNotFound","class":"d-none text-center p-2"}).append($("<small/>").text("Not found")));$(f).append(g.append(b.append(a).append(d)));$.ajax({url:"api/search/filters/countries",type:"GET",data:{t:i,q:ModuleSearch.input.q.getValue(),m:ModuleSearch.input.m.getValue(),lf:ModuleSearch.input.lf.getValue(),lt:ModuleSearch.input.lt.getValue(),lc:ModuleSearch.input.lc.getValue(),ps:ModuleSearch.input.ps.getValue(),pr:ModuleSearch.input.pr.getValue(),id:ModuleSearch.input.id.getValue(),tor:ModuleSearch.input.tor.getValue(),},success:function(e){if(e.success){$(e.countries).each(function(){if(!this.active){Search.registry.filterCountriesList.push({code:this.code,name:this.name.toLowerCase(),})}(this.active?c:h).append($("<div/>",{id:"filterCountry-"+this.code,"class":"filter-country dropdown-item cursor-pointer"+(this.active?" active ":"")+(this.total==0?" text-secondary":""),onclick:"$(this).hasClass('active') ? ModuleSearch.submitFilterLf('delete','"+this.code+"') : ModuleSearch.submitFilterLf('add','"+this.code+"')",}).append($("<img/>",{"class":"flag mr-2",alt:this.code,src:this.flag,})).append($("<small/>").append(this.name).append($("<small/>",{"class":"ml-1"}).append("("+this.total+")"))).append($("<i/>",{"class":"material-icons action done"}).append("done")).append($("<i/>",{"class":"material-icons action close"}).append("close")))});g.prepend($("<div/>",{"class":"btn btn-sm dropdown-toggle mr-4 pl-0 pr-0"+(e.exists==0?" text-secondary":""),"data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false",}).append($("<span/>").text(e.active.text)));var l=$("<div/>",{"class":"p-0 btn btn-sm",});var k=$("<input/>",{type:"checkbox",checked:(e.tor==""?"checked":false),"data-toggle":"toggle","data-size":"xs","data-on":"TOR","data-off":"TOR",onchange:"ModuleSearch.submitFilterTOR("+(e.tor==""?"'false'":"")+")",});a.append(l.append(k));if(e.active.total>0){d.append(c);a.append($("<div/>",{"class":"btn btn-sm text-primary border-left ml-2 pr-0",onclick:"ModuleSearch.submitFilterLf(false, false)"}).append("Clear"))}d.append(h);k.bootstrapToggle()}},})},loadFilterConditions:function(c){var a=$("<div/>",{"class":"toolbar"});var b=$("<div/>",{"class":"dropdown-menu",});$(c).append(a.append(b));$.ajax({url:"api/search/filters/conditions",type:"GET",data:{q:ModuleSearch.input.q.getValue(),m:ModuleSearch.input.m.getValue(),lf:ModuleSearch.input.lf.getValue(),lt:ModuleSearch.input.lt.getValue(),lc:ModuleSearch.input.lc.getValue(),ps:ModuleSearch.input.ps.getValue(),pr:ModuleSearch.input.pr.getValue(),id:ModuleSearch.input.id.getValue(),tor:ModuleSearch.input.tor.getValue(),},success:function(d){if(d.success){$(d.conditions).each(function(){b.append($("<div/>",{"class":"dropdown-item cursor-pointer"+(this.active?" active ":"")+(this.total==0?" text-secondary":""),onclick:"$(this).hasClass('active') ? ModuleSearch.submitFilterLc('delete','"+this.value+"') : ModuleSearch.submitFilterLc('add','"+this.value+"')",}).append($("<small/>").append(this.name).append($("<small/>",{"class":"ml-1"}).append("("+this.total+")"))).append($("<i/>",{"class":"material-icons action done"}).append("done")).append($("<i/>",{"class":"material-icons action close"}).append("close")))});a.prepend($("<div/>",{"class":"btn btn-sm dropdown-toggle mr-4 pl-0 pr-0"+(d.exists==0?" text-secondary":""),"data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false",}).append($("<span/>").text(d.active.text)))}},})},loadFilterTypes:function(c){var b=$("<div/>",{"class":"toolbar"});var a=$("<div/>",{"class":"dropdown-menu",});$(c).append(b.append(a));$.ajax({url:"api/search/filters/types",type:"GET",data:{q:ModuleSearch.input.q.getValue(),m:ModuleSearch.input.m.getValue(),lf:ModuleSearch.input.lf.getValue(),lt:ModuleSearch.input.lt.getValue(),lc:ModuleSearch.input.lc.getValue(),ps:ModuleSearch.input.ps.getValue(),pr:ModuleSearch.input.pr.getValue(),id:ModuleSearch.input.id.getValue(),tor:ModuleSearch.input.tor.getValue(),},success:function(d){if(d.success){$(d.types).each(function(){a.append($("<div/>",{"class":"dropdown-item cursor-pointer"+(this.active?" active ":"")+(this.total==0?" text-secondary":""),onclick:"$(this).hasClass('active') ? ModuleSearch.submitFilterLt('delete','"+this.value+"') : ModuleSearch.submitFilterLt('add','"+this.value+"')",}).append($("<small/>").append(this.name).append($("<small/>",{"class":"ml-1"}).append("("+this.total+")"))).append($("<i/>",{"class":"material-icons action done"}).append("done")).append($("<i/>",{"class":"material-icons action close"}).append("close")))});b.prepend($("<div/>",{"class":"btn btn-sm dropdown-toggle mr-4 pl-0 pr-0"+(d.exists==0?" text-secondary":""),"data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false",}).append($("<span/>").text(d.active.text)))}},})},loadFilterRatings:function(d,a){var c=$("<div/>",{"class":"toolbar"});var b=$("<div/>",{"class":"dropdown-menu",});$(d).append(c.append(b));$.ajax({url:"api/search/filters/ratings",type:"GET",data:{t:a,q:ModuleSearch.input.q.getValue(),m:ModuleSearch.input.m.getValue(),lf:ModuleSearch.input.lf.getValue(),lt:ModuleSearch.input.lt.getValue(),lc:ModuleSearch.input.lc.getValue(),ps:ModuleSearch.input.ps.getValue(),pr:ModuleSearch.input.pr.getValue(),id:ModuleSearch.input.id.getValue(),tor:ModuleSearch.input.tor.getValue(),},success:function(e){if(e.success){$(e.ratings).each(function(){var f=$("<span/>");for(var g=0;g<this.value;g++){f.append($("<i/>",{"class":"material-icons name ml-1 mr-1 mb-1 text-warning"}).append("star"))}b.append($("<div/>",{"class":"dropdown-item cursor-pointer"+(this.active?" active ":"")+(this.total==0?" text-secondary":""),onclick:"$(this).hasClass('active') ? ModuleSearch.submitFilterPr('delete','"+this.value+"') : ModuleSearch.submitFilterPr('add','"+this.value+"')",}).append($("<small/>").append(f.append($("<small/>",{"class":"ml-1"}).append("("+this.total+")")))).append($("<i/>",{"class":"material-icons action done"}).append("done")).append($("<i/>",{"class":"material-icons action close"}).append("close")))});c.prepend($("<div/>",{"class":"btn btn-sm dropdown-toggle mr-4 pl-0 pr-0"+(e.exists==0?" text-secondary":""),"data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false",}).append($("<span/>").text(e.active.text)))}},})},loadFilterModerators:function(b){var a=$("<div/>",{"class":"toolbar"});$(b).append(a);$.ajax({url:"api/search/filters/moderators",type:"GET",data:{q:ModuleSearch.input.q.getValue(),m:ModuleSearch.input.m.getValue(),lf:ModuleSearch.input.lf.getValue(),ps:ModuleSearch.input.ps.getValue(),pr:ModuleSearch.input.pr.getValue(),id:ModuleSearch.input.id.getValue(),tor:ModuleSearch.input.tor.getValue(),},success:function(c){if(c.success){a.prepend($("<div/>",{"class":"btn btn-sm pl-0 pr-0 pr-4"+(c.active?" active":"")+(c.total==0?" text-secondary":""),onclick:"$(this).hasClass('active') ? ModuleSearch.submitFilterM(false) : ModuleSearch.submitFilterM('true')",}).append($("<span/>").text(c.text)).append(c.active?$("<i/>",{"class":"material-icons action done"}).append("done"):"").append(c.active?$("<i/>",{"class":"material-icons action close"}).append("close"):""))}},})},loadFilterProtected:function(b){var a=$("<div/>",{"class":"toolbar"});$(b).append(a);$.ajax({url:"api/search/filters/protected",type:"GET",data:{q:ModuleSearch.input.q.getValue(),m:ModuleSearch.input.m.getValue(),lf:ModuleSearch.input.lf.getValue(),lt:ModuleSearch.input.lt.getValue(),lc:ModuleSearch.input.lc.getValue(),ps:ModuleSearch.input.ps.getValue(),pr:ModuleSearch.input.pr.getValue(),id:ModuleSearch.input.id.getValue(),tor:ModuleSearch.input.tor.getValue(),},success:function(c){if(c.success){a.prepend($("<div/>",{"class":"btn btn-sm pl-0 pr-0 pr-4"+(c.active?" active":"")+(c.total==0?" text-secondary":""),onclick:"$(this).hasClass('active') ? ModuleSearch.submitFilterM(false) : ModuleSearch.submitFilterM('true')",}).append($("<span/>").text(c.text)).append(c.active?$("<i/>",{"class":"material-icons action done"}).append("done"):"").append(c.active?$("<i/>",{"class":"material-icons action close"}).append("close"):""))}},})},listing:{page:1,total:0,lock:false,load:function(c,b,d,a){if(a){$(c).html("");$(d).removeClass("d-none");$(b).addClass("d-none");$(b).addClass("disabled");Search.listing.page=1}if(Search.listing.lock==false){$.ajax({url:"api/search/listing",type:"GET",data:{p:Search.listing.page,q:ModuleSearch.input.q.getValue(),s:ModuleSearch.input.s.getValue(),o:ModuleSearch.input.o.getValue(),m:ModuleSearch.input.m.getValue(),lf:ModuleSearch.input.lf.getValue(),lt:ModuleSearch.input.lt.getValue(),lc:ModuleSearch.input.lc.getValue(),ps:ModuleSearch.input.ps.getValue(),pr:ModuleSearch.input.pr.getValue(),id:ModuleSearch.input.id.getValue(),tor:ModuleSearch.input.tor.getValue(),},beforeSend:function(){Search.listing.lock=true;$(b).addClass("disabled")},success:function(e){if(e.success){$(d).addClass("d-none");Search.listing.page++;if(e.listings.length){$(e.listings).each(function(){Search.listing.total++;if(this.nsfw.status){$(c).append($("<div/>",{"class":"result unhover rounded mt-2 mb-2 pt-2 pb-2",}).append($("<div/>",{"class":"text-center border rounded pt-2 pb-3 pl-2 pr-2",}).append($("<i/>",{"class":"material-icons text-secondary"}).append("visibility_off")).append($("<div/>",{"class":"text-secondary text-uppercase pt-2 pb-1"}).append(this.nsfw.text)).append($("<code/>",{"class":"text-secondary"}).append(this.hash))))}else{$(c).append($("<div/>",{"class":"result rounded mt-2 mb-2 pt-2 pb-2",}).append($("<div/>",{"class":"row",}).append($("<div/>",{"class":"col-2 pr-0",}).append($("<a/>",{href:"listing/"+this.hash,}).append($("<img/>",{"class":"w-100 mt-1 rounded",alt:this.image,src:"api/image?hash="+this.image})))).append($("<div/>",{"class":"col-8 position-relative",}).append($("<a/>",{href:"listing/"+this.hash,}).append($("<h6/>").append(this.title))).append($("<div/>",{"class":"description "+(!this.available?"text-secondary":"")}).append(this.description)).append($("<div/>").append($("<i/>",{"class":"material-icons online mr-1 "+(this.profile.online.status=="online"?"text-success":this.profile.online.status=="active"?"text-warning":"text-danger"),title:this.profile.online.text}).append("lens")).append($("<small/>",{"class":"mr-1 d-lg-none d-xl-none "+(this.profile.online.status=="online"?"text-success":this.profile.online.status=="active"?"text-warning":"text-danger")}).append(this.profile.online.text)).append($("<"+(this.profile.name?"small":"code")+"/>",{"class":"text-secondary"}).append($("<a/>",{href:"profile/"+this.profile.peerId,}).append(this.profile.name?this.profile.name:this.profile.peerId))))).append($("<div/>",{"class":"col-2 text-center pl-0",}).append($("<div/>",{"class":"text-success",}).append(this.price)).append($("<div/>",{"class":"text-uppercase",}).append($("<small/>").append(this.condition))).append($("<div/>",{"class":"text-muted",}).append($("<small/>").append(this.contractType))).append($("<a/>",{"class":"badge mt-2 pt-1 pb-1 pl-2 pr-2 "+(this.payment.security=="danger"?"badge-danger":(this.payment.security=="moderated"?"badge-primary":"badge-success")),href:"ob://"+this.peerId+"/store/"+this.slug,title:this.payment.text}).append(this.payment.security=="danger"?$("<i/>",{"class":"material-icons mr-1"}).append("warning"):(this.payment.security=="moderated"?$("<i/>",{"class":"material-icons mr-1"}).append("security"):"")).append("Buy")))))}})}else{$(c).html($("<div/>",{"class":"mt-3 pt-5 pb-5 border-top text-center",}).append(e.message))}if(a){var f=$("<div/>",{"class":"btn-toolbar",});Search.loadSorts(f,"listing");Search.loadFilterConditions(f);Search.loadFilterTypes(f);Search.loadFilterCountries(f,"listing");Search.loadFilterProtected(f);$(c).prepend(f)}if(Search.listing.total<e.total){$(b).removeClass("d-none");$(b).removeClass("disabled")}else{$(b).addClass("d-none");$(b).addClass("disabled")}Search.listing.lock=false}}})}}},profile:{page:1,total:0,lock:false,load:function(c,b,d,a){if(a){$(c).html("");$(d).removeClass("d-none");$(b).addClass("d-none");$(b).addClass("disabled");Search.profile.page=1}if(Search.profile.lock==false){$.ajax({url:"api/search/profile",type:"GET",data:{p:Search.profile.page,q:ModuleSearch.input.q.getValue(),s:ModuleSearch.input.s.getValue(),o:ModuleSearch.input.o.getValue(),m:ModuleSearch.input.m.getValue(),lf:ModuleSearch.input.lf.getValue(),ps:ModuleSearch.input.ps.getValue(),pr:ModuleSearch.input.pr.getValue(),tor:ModuleSearch.input.tor.getValue(),},beforeSend:function(){Search.profile.lock=true;$(b).addClass("disabled")},success:function(e){if(e.success){$(d).addClass("d-none");Search.profile.page++;if(e.profiles.length){$(e.profiles).each(function(){Search.profile.total++;if(this.nsfw.status){$(c).append($("<div/>",{"class":"result unhover rounded mt-2 mb-2 pt-2 pb-2",}).append($("<div/>",{"class":"text-center border rounded pt-2 pb-3 pl-2 pr-2",}).append($("<i/>",{"class":"material-icons text-secondary"}).append("visibility_off")).append($("<div/>",{"class":"text-secondary text-uppercase pt-2 pb-1"}).append(this.nsfw.text)).append($("<code/>",{"class":"text-secondary"}).append(this.peerId))))}else{$(c).append($("<div/>",{"class":"result rounded position-relative mt-2 mb-2 pt-2 pb-2",}).append($("<div/>",{"class":"row",}).append($("<div/>",{"class":"col-2 pr-0",}).append($("<a/>",{href:"profile/"+this.peerId,}).append($("<img/>",{"class":"w-100 mt-1 rounded",alt:this.avatar,src:"api/image?hash="+this.avatar})))).append($("<div/>",{"class":"col-10",}).append($("<a/>",{href:"profile/"+this.peerId,}).append($("<h6/>").append(this.name))).append($("<div/>",{"class":"description "+(!this.available?"text-secondary":"")}).append(this.shortDescription)).append($("<div/>").append($("<i/>",{"class":"material-icons online mr-1 "+(this.online.status=="online"?"text-success":this.online.status=="active"?"text-warning":"text-danger"),title:this.online.text}).append("lens")).append($("<small/>",{"class":"mr-1 d-lg-none d-xl-none "+(this.online.status=="online"?"text-success":this.online.status=="active"?"text-warning":"text-danger")}).append(this.online.text)).append($("<code/>",{"class":"text-secondary"}).append(this.peerId))))))}})}else{$(c).html($("<div/>",{"class":"mt-3 pt-5 pb-5 border-top text-center",}).append(e.message))}if(a){var f=$("<div/>",{"class":"btn-toolbar",});Search.loadSorts(f,"profile");Search.loadFilterRatings(f,"profile");Search.loadFilterCountries(f,"profile");Search.loadFilterModerators(f);$(c).prepend(f)}if(Search.profile.total<e.total){$(b).removeClass("d-none");$(b).removeClass("disabled")}else{$(b).addClass("d-none");$(b).addClass("disabled")}Search.profile.lock=false}}})}}},};$(document).ready(function(){ModuleSearch.subscribe.init();if("profile"==$("select[name=t]").val()){Search.profile.load("#searchProfileData","#searchProfileLoad","#searchProfileLoading",true)}else{Search.listing.load("#searchListingData","#searchListingLoad","#searchListingLoading",true)}});